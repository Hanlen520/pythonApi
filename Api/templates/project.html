<!DOCTYPE html>
<html>
    <head>
        <title>API自动化测试用例</title>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        {% set pro_name = tasks['pro_name'] %}
        {% set nginx_api_proxy = tasks['nginx_api_proxy'] %}
        {% set test_case_list = tasks['test_case_list'] %}
        <link href="/{{nginx_api_proxy}}/static/css/bootstrap.min.css" rel="stylesheet">
        <link href="/{{nginx_api_proxy}}/static/css/sweetalert.min.css" rel="stylesheet"/>
        <link href="/{{nginx_api_proxy}}/static/css/font-awesome.css" rel="stylesheet"/>
        <link href="/{{nginx_api_proxy}}/static/css/dataTables.bootstrap.css" rel="stylesheet"/>
    </head>

    <body>
        <div id="page-wrapper">
            <div class="header" align="center">
                <h1 class="page-header"> API&nbsp;自&nbsp;动&nbsp;化&nbsp;测&nbsp;试&nbsp;用&nbsp;例&nbsp;-&nbsp;{{pro_name}}&nbsp;项&nbsp;目 </h1>
            </div>
            <div id="page-inner">
               <div class="row">
                  <div class="col-lg-12">

                      <div class="col-xs-12 col-md-8" style="margin-left:5%">
                          <div class="panel panel-default">
                             <div class="panel-heading" align="center" style="font-size:15px; color: #B8860B; font-weight: bold;">
                                 导&nbsp;&nbsp;&nbsp;入&nbsp;&nbsp;&nbsp;用&nbsp;&nbsp;&nbsp;例&nbsp;&nbsp;&nbsp;操&nbsp;&nbsp;&nbsp;作
                             </div>
                             <div class="panel-body">
                                 <form id="import_action_form" class="form-horizontal" enctype="multipart/form-data">
                                    <div class="col-sm-12">
                                        <div class="col-sm-4">
                                            <label style="color: #B8860B; font-weight: bold;">选择 用例文件（.xls .xlsx .csv）</label>
                                            <input class="form-control" id="file" type="file" name="file"/>
                                        </div>
                                        <div class="col-sm-3" style="margin-left:5%;">
                                            <label style="color: #B8860B; font-weight: bold;">选择 导入方式</label>
                                            <select class="form-control" name="import_method" id="import_method">
                                                <option value="">请 选 择</option>
                                                <option value="batch_insert">批 量 新 增</option>
                                                <option value="all_replace">全 部 替 换</option>
                                                <option value="batch_insert_and_replace">批 量 新 增 + 替 换</option>
                                            </select>
                                        </div>
                                        <div class="col-sm-3" align="center" style="line-height:70px;">
                                            <a style="margin-left:10%" href="/api_case_tmpl" download="测试用例模板.xlsx"
                                                onMouseOver="this.style.cursor='hand',this.style.color='#FF0000'"
                                                onMouseOut="this.style.color='#006699'">点击下载 测试用例模板
                                            </a>
                                        </div>
                                    </div>
                                    <div class="col-sm-12" style="margin-top: 2%">
                                        <div class="col-sm-3" align="center" style="line-height:30px;">
                                            <button id="import_btn" name="import_btn" type="button" class="btn btn-primary"
                                                    data-loading-text="Importing..." onclick="exec_import('{{ pro_name }}','{{ nginx_api_proxy }}')"> 执行导入
                                            </button>
                                        </div>
                                        <div class="col-sm-3" align="center" style="line-height:35px; font-size:15px;">
                                            <span id="exec_result" style="font-size:15px" class="label label-info"></span>
                                        </div>
                                    </div>
                                 </form>

                             </div>
                          </div>
                      </div>

                  </div>
               </div>
            </div>

            <div id="page-inner2">
               <div class="row">
                  <div class="col-lg-12">
                     <div class="col-xs-12 col-md-11" style="margin-left:2%">
                        <div class="panel panel-default">
                            <div class="panel-heading" align="center" style="font-size:15px; color: #B8860B; font-weight: bold;">
                                API&nbsp;&nbsp;&nbsp;接&nbsp;&nbsp;&nbsp;口&nbsp;&nbsp;&nbsp;查&nbsp;&nbsp;&nbsp;询
                             </div>
                            <div class="panel-body">
                                <div class="card">
                                    <div class="card-body card-padding">
                                        <div class="row" role="form">
                                            <div class="col-sm-2">
                                                <div class="fg-line">
                                                    <input id="interface_name" name="interface_name" type="text" class="form-control" placeholder="接口名称">
                                                </div>
                                            </div>
                                            <div class="col-sm-3">
                                                <div class="fg-line">
                                                    <input id="interface_url" name="interface_url" type="text" class="form-control" placeholder="接口地址">
                                                </div>
                                            </div>
                                            <div class="col-sm-2">
                                                <div class="input-group">
                                                    <span class="input-group-addon">请求方式：</span>
                                                    <div class="fg-line">
                                                        <select class="form-control" id="request_method" name="request_method">
                                                            <option value="">全部</option>
                                                            <option value="GET">GET</option>
                                                            <option value="POST">POST</option>
                                                            <option value="PUT">PUT</option>
                                                            <option value="DELETE">DELETE</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-2">
                                                <div class="input-group">
                                                    <span class="input-group-addon">用例状态：</span>
                                                    <div class="fg-line">
                                                        <select class="form-control" id="case_status" name="case_status">
                                                            <option value="">全部</option>
                                                            <option value="true">上线</option>
                                                            <option value="false">下线</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-1">
                                                <div class="input-group" id="search_btn">
                                                    <button class="btn btn-success btn-icon" onclick="search_case('{{ pro_name }}','{{ nginx_api_proxy }}')"><i class="fa fa-search"></i></button>
                                                </div>
                                            </div>

                                            <div class="col-sm-1">
                                                <span class="input-group">
                                                    <button class="btn btn-default" type="button" data-toggle="modal" data-target="#add_case_form"><i class="fa fa-plus-circle fa-2x" style="color: #FFA07A"></i></button>
                                                </span>
                                            </div>
                                        </div>

                                        <div class="table-responsive" style="margin-top: 1%">
                                            <table class="table table-striped">
                                                <thead>
                                                <tr>
                                                    <th>接口名称</th>
                                                    <th class="text-center">请求方式</th>
                                                    <th>接口地址</th>
                                                    <th class="text-center">验证关键字段</th>
                                                    <th class="text-center">验证模式</th>
                                                    <th class="text-center">用例状态</th>
                                                    <th class="text-center">更新时间</th>
                                                    <th class="text-center">操作</th>
                                                </tr>
                                                </thead>
                                                <tbody id="case_tbody">
                                                {% for test_case in test_case_list %}
                                                    {% set _id = test_case["_id"] %}
                                                    {% set interface_name = test_case["interface_name"] %}
                                                    {% set request_method = test_case["request_method"] %}
                                                    {% set interface_url = test_case["interface_url"] %}
                                                    {% set request_params = test_case["request_params"] %}
                                                    {% set compare_core_field_name = test_case["compare_core_field_name"] %}
                                                    {% set expect_core_field_value = test_case["expect_core_field_value"] %}
                                                    {% set expect_field_name_list = test_case["expect_field_name_list"] %}
                                                    {% set verify_mode = test_case["verify_mode"] %}
                                                    {% set case_status = test_case["case_status"] %}
                                                    {% set update_time = test_case["update_time"] %}
                                                    <tr>
                                                        <td style="width: 150px; display:table-cell; vertical-align:middle;">{{ interface_name }}</td>
                                                        <td class="text-center" style="width: 100px; display:table-cell; vertical-align:middle;">{{ request_method }}</td>
                                                        <td style="width: 250px; display:table-cell; vertical-align:middle;" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-container="body" title="请求参数" data-content="{{ request_params }}">{{ interface_url }}</td>
                                                        <td  class="text-center" style="width: 100px; display:table-cell; vertical-align:middle;" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-container="body" title="期望的关键字段值" data-content="{{ expect_core_field_value }}">{{ compare_core_field_name }}</td>
                                                        <td class="text-center" style="width: 100px; display:table-cell; vertical-align:middle;" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-container="body" title="期望的响应字段列表" data-content="{{ expect_field_name_list }}">{{ verify_mode }}</td>
                                                        <td class="text-center" style="width: 100px; display:table-cell; vertical-align:middle;"> {% if case_status %} <font color="#00A600">上线</font> {% else %} <font color="#DC143C">下线</font> {% endif %} </td>
                                                        <td class="text-center" style="width: 150px; display:table-cell; vertical-align:middle;">{{ update_time }}</td>
                                                        <td class="text-center" style="width: 100px; display:table-cell; vertical-align:middle;">
                                                            <button class="btn btn-default" type="button" onclick="fill_edit_frame()" data-toggle="modal" data-target="#edit_case"><i class="fa fa-edit" style="color: #6A5ACD"></i></button>
                                                            <button class="btn btn-default" type="button" onclick="del_case('{{ pro_name }}','{{ nginx_api_proxy }}', '{{ _id }}')"><i class="fa fa-trash-o fa-lg" style="color: #ff0000"></i></button>
                                                        </td>
                                                    </tr>
                                                {% endfor %}

                                                </tbody>

                                            </table>

                                        </div>

                                    </div>
                                </div>

                            </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>

        </div>

        <div id='ending'>&nbsp;</div>
        <div style=" position:fixed;right:50px; bottom:30px; width:20px; height:20px;cursor:pointer">
            <a href="#"><span class="glyphicon glyphicon-eject" style = "font-size:30px;" aria-hidden="true"></span></a>
        </div>

        <!-- 新增窗口 -->
        <div id="add_case_form" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <button class="close" data-dismiss="modal">
                            <span>&times;</span>
                        </button>
                        <div class="modal-title">
                            <h2 class="text-center">新增测试用例</h2>
                        </div>
                    </div>

                    <div class="modal-body">
                        <div class="form-group">
                            <label>接口名称：<font color="#DC143C">(必填)</font></label>
                            <input class="form-control" type="text" id="interface_name_all" placeholder="接口名称">
                        </div>
                        <div class="form-group">
                            <label>接口地址：<font color="#DC143C">(必填)</font></label>
                            <input class="form-control" type="text" id="interface_url_all" placeholder="接口地址">
                        </div>
                        <div class="form-group">
                            <label>请求方式：<font color="#DC143C">(必选)</font></label>
                            <div class="fg-line">
                                <select class="form-control" id="request_method_all">
                                    <option value=""></option>
                                    <option value="GET">GET</option>
                                    <option value="POST">POST</option>
                                    <option value="PUT">PUT</option>
                                    <option value="DELETE">DELETE</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>请求头文件：<font color="#B8860B">eg: &nbsp;{"Content-Type": "application/json"}</font></label>
                            <input class="form-control" type="text" id="request_header_all" placeholder="请求头文件">
                        </div>
                        <div class="form-group">
                            <label>请求参数：<font color="#B8860B">eg: &nbsp;?name=测试&age=30&nbsp;&nbsp;或&nbsp;&nbsp;{"name":"测试","age":30}</font></label>
                            <input class="form-control" type="text" id="request_params_all" placeholder="请求参数">
                        </div>
                        <div class="form-group">
                            <label>验证模式：<font color="#DC143C">(必选)</font></label>
                            <div class="fg-line">
                                <select class="form-control" id="verify_mode_all">
                                    <option value=""></option>
                                    <option value="1">仅验证关键字段</option>
                                    <option value="2">同时验证关键字段和验证响应参数列表</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>待比较关键字段名：<font color="#DC143C">(必填)&nbsp;&nbsp;</font><font color="#B8860B">eg：&nbsp;msg,code</font></label>
                            <input class="form-control" type="text" id="compare_core_field_name_all" placeholder="待比较关键字段名">
                        </div>
                        <div class="form-group">
                            <label>期望的关键字段值：<font color="#DC143C">(必填)&nbsp;&nbsp;</font><font color="#B8860B">eg：&nbsp;请求成功,301200</font></label>
                            <input class="form-control" type="text" id="expect_core_field_value_all" placeholder="期望的关键字段值">
                        </div>

                        <div class="form-group">
                            <label>期望的响应字段列表：</font><font color="#B8860B">eg: &nbsp;status,msg,code</font></label>
                            <input class="form-control" type="text" id="expect_field_name_list_all" placeholder="期望的响应字段列表">
                        </div>
                        <div class="form-group">
                            <label>依赖接口名称：</font><font color="#B8860B">eg: &nbsp;登录接口,获取验证码接口</font></label>
                            <input class="form-control" type="text" id="depend_interface_all" placeholder="依赖接口名称">
                        </div>
                        <div class="form-group">
                            <label>依赖字段名：</font><font color="#B8860B">eg: &nbsp;token,sms_code</font></label>
                            <input class="form-control" type="text" id="depend_field_name_all" placeholder="依赖字段名">
                        </div>
                        <div class="form-group">
                            <label>依赖字段值：</font><font color="#B8860B">eg: &nbsp;123456,383838</font></label>
                            <input class="form-control" type="text" id="depend_field_value_all" placeholder="依赖字段值">
                        </div>
                        <div class="form-group">
                            <label>用例状态：</label>
                            <div class="fg-line">
                                <select class="form-control" id="case_status_all">
                                    <option value="false">下线</option>
                                    <option value="true">上线</option>
                                </select>
                            </div>
                        </div>

                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span>关闭</button>
                        <button type="button" class="btn btn-primary" data-dismiss="modal" id="save" onclick="add_case('{{ pro_name }}','{{ nginx_api_proxy }}')"><span class="glyphicon glyphicon-floppy-disk"></span>保存</button>
                    </div>
                </div>
            </div>
        </div>


        <script src="/{{nginx_api_proxy}}/static/scripts/jquery.min.js" type="text/javascript"></script>
        <script src="/{{nginx_api_proxy}}/static/scripts/bootstrap.min.js" type="text/javascript"></script>
        <script src="/{{nginx_api_proxy}}/static/scripts/common.js" type="text/javascript"></script>
        <script src="/{{nginx_api_proxy}}/static/scripts/project.js" type="text/javascript"></script>
        <script src="/{{nginx_api_proxy}}/static/scripts/sweetalert.min.js" type="text/javascript"></script>
        <script src="/{{nginx_api_proxy}}/static/scripts/jquery.dataTables.js" type="text/javascript"></script>
        <script src="/{{nginx_api_proxy}}/static/scripts/dataTables.bootstrap.js" type="text/javascript"></script>

        <script type="text/JavaScript">
            $(function (){
                $("[data-toggle='popover']").popover();
            });
        </script>

    </body>
</html>
